# media-preview.js 说明文档

## 0.在 http://118.178.254.226/a/Orther/2025/0417/50.html 页面中进行效果体验

## 1. 介绍

`media-preview.js` 是一个基于原有 `image-preview.js` 重构的媒体预览组件，提供了高质量的图片预览、缩放、拖拽等功能，具有良好的移动端支持和用户体验。

## 2. 使用说明

### 2.1 基本步骤

#### 第1步：添加脚本

将脚本添加到HTML页面中：

```html
<script src="/templets/default/js/media-preview.js"></script>
```

#### 第2步：配置图片选择器（可选）

如需修改默认支持的图片选择器，请在`CONFIG`对象的`IMAGE_SELECTORS`数组中进行调整：

```javascript
IMAGE_SELECTORS: [ // 图片选择器及对应的描述属性
    { selector: '.image-carousel img', captionAttr: 'alt' }, // 轮播图图片，使用alt属性作为描述
    { selector: '.Content-Type img', captionAttr: 'title' }  // 内容区域图片，使用title属性作为描述
],
```

您可以添加更多的选择器配置，或修改现有的配置，图片浏览器会按照配置器的顺序进行组合。每个配置项包含：
- `selector`：CSS选择器，用于选择需要支持预览的图片
- `captionAttr`：用于获取图片描述文本的HTML属性名

#### 第3步：其他配置调整（可选）

根据需要，您可以调整其他配置项：

```javascript
ZOOM: { // 缩放相关配置
    MIN: 0.8, // 最小缩放比例
    MAX: 5,   // 最大缩放比例
    STEP: 0.1 // 滚轮缩放步长
},
ANIMATION: { // 动画相关配置
    DURATION: 300, // 动画持续时间 (ms)
    TIMING: 'ease'   // 动画时间函数
}
// 其他配置项...
```

### 2.2 HTML结构要求

为确保预览功能正常工作，请确保您的图片元素：

1. 符合配置中定义的选择器
2. 具有相应的描述属性（如`alt`或`title`）
3. 确保图片有正确的`src`属性指向有效的图片资源

示例：

```html
<!-- 轮播图示例 -->
<div class="image-carousel">
    <img src="image1.jpg" alt="图片1描述" />
    <img src="image2.jpg" alt="图片2描述" />
</div>

<!-- 内容区域图片示例 -->
<div class="Content-Type">
    <img src="image3.jpg" title="图片3描述" />
</div>
```

### 2.3 自动初始化

脚本会在页面加载完成后自动初始化，无需额外的JavaScript调用。图片预览功能将自动应用于符合选择器的所有图片。

### 2.4 样式依赖

组件会自动加载样式文件。默认样式路径为：

```html
<link rel="stylesheet" href="/templets/default/style/image-preview.css">
```

如需修改样式路径，请在`CONFIG`对象中更新`CSS_PATH`值。

## 3. 功能特性

- **图片预览**：点击图片查看全屏预览
- **图片缩放**：支持鼠标滚轮、双击和触摸缩放
- **平滑拖拽**：支持图片拖拽、滑动切换
- **垂直拖拽关闭**：向下拖拽可关闭预览
- **缩略图导航**：底部显示缩略图，支持点击导航
- **键盘导航**：使用方向键切换图片，ESC关闭预览
- **触摸支持**：完善的移动端手势支持
  - 双指缩放 (Pinch to zoom)
  - 惯性滚动
  - 双击/双指缩放
- **响应式设计**：自适应不同屏幕尺寸

## 4. 代码编写规范

### 4.1 模块化编写规则

- **使用立即执行函数表达式(IIFE)**：所有代码必须封装在IIFE中，避免全局变量污染
  ```javascript
  (function() {
    // 模块代码
  })();
  ```

- **模块划分**：代码应按以下模块划分：
  1. 配置管理 (`CONFIG`)
  2. 状态管理 (`createStore`, `store`)
  3. DOM元素缓存 (`DOM`)
  4. 工具函数 (`Utils`)
  5. UI构建 (`UIBuilder`)
  6. 核心功能 (`ImagePreview`)
  7. 功能处理模块 (`DragHandler`, `ZoomHandler`, `InertiaHandler`, `DoubleClickZoomHandler`等)
- **状态管理**：使用状态管理器统一管理状态，避免全局变量
- **功能内聚**：每个模块应职责单一，内聚性高，只处理特定功能

### 4.2 注释规范

- **模块注释**：每个功能模块前必须添加简明注释，说明模块功能
  ```javascript
  // 工具函数模块
  const Utils = { // 模块实现
  };
  ```

- **函数注释**：所有函数前添加简洁说明注释
  ```javascript
  // 处理滚轮缩放
  handleWheelZoom(e) { // 函数实现
  }
  ```

- **变量注释**：关键变量和配置项后添加注释
  ```javascript
  MIN: 0.8, // 最小缩放比例
  ```

- **代码段注释**：复杂逻辑段落应添加注释说明
- **使用中文**：所有注释必须使用中文，语言简练精准
- **注释位置**：行内注释通常在代码右侧，代码段注释在代码上方

### 4.3 配置管理规范

- **集中配置**：所有可配置项必须集中在 `CONFIG` 对象中
- **分类管理**：按功能类别组织配置项，如 `ZOOM`, `ANIMATION`, `DRAG` 等
- **使用常量**：避免在代码中使用魔法数字，统一通过配置常量引用

### 4.4 命名规范

- **驼峰命名法**：变量和函数使用驼峰命名法 (`camelCase`)
- **常量全大写**：常量使用全大写加下划线 (`UPPER_CASE`)
- **语义化命名**：名称应清晰表达意图，避免模糊缩写
- **前缀约定**：
  - `is`/`has` 前缀用于布尔值变量
  - `handle`/`on` 前缀用于事件处理函数
  - `create` 前缀用于创建DOM元素的函数

### 4.5 事件处理规范

- **委托模式**：尽量使用事件委托，减少事件监听器数量
- **被动监听**：使用 `{passive: true/false}` 优化触摸事件性能
- **清理机制**：确保添加的动画帧、定时器等资源在适当时机被清理

### 4.6 性能优化规范

- **DOM缓存**：避免重复查询DOM，使用DOM缓存对象
- **节流与防抖**：对频繁触发的事件使用节流或防抖处理
- **硬件加速**：适当使用 `will-change`, `transform` 等启用硬件加速
- **动画帧优化**：使用 `requestAnimationFrame` 处理动画，避免使用 `setTimeout`

### 4.7 代码风格规范

- **紧凑布局**：仅在不同功能模块间使用换行分隔，避免过度分散
- **内聚摆放**：相关代码应放在一起，保持代码块的内聚性
- **精简代码**：移除多余的空行和缩进，在保持可读性的前提下减少代码行数
- **直观清晰**：代码结构应直观反映逻辑关系，提高一眼可读性
- **统一风格**：整个文件保持一致的缩进和格式风格
- **精确注释**：使用精准的中文语言进行注释，使得主要逻辑均可以依据注释来明确

## 5. 更新与维护

- 遵循语义化版本控制
- 代码更新前必须理解现有结构
- 保持接口一致性，避免破坏性变更
- 添加新功能时，确保与现有架构风格一致
